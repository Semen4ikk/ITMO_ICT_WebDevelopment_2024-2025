<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>views - WEB-programming</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "views";
        var mkdocs_page_input_path = "views.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> WEB-programming
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">2 lab</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../models/">models</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">views</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#_2">Описание</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_3">Стек</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_4">Листинг</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#viewspy">views.py:</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_5">Представление главной страницы:</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_6">Представление регистрации:</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_7">Представление авторизации и входа:</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_8">Представление билетов:</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_9">Представление полетов:</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_10">Представление пассажиров:</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_11">Представление Комментария:</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_12">Представление операций над билетами:</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_13">Представление подтверждения бронирования для администратра:</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../urls/">urls</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../forms/">forms</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../settings/">settings</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">WEB-programming</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">2 lab</li>
      <li class="breadcrumb-item active">views</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="_1">Ссылки</h1>
<h2 id="_2">Описание</h2>
<p>Реализовать ссылки для приложения.</p>
<h2 id="_3">Стек</h2>
<ul>
<li>Язык: Python</li>
<li>Библиотека: django</li>
</ul>
<h2 id="_4">Листинг</h2>
<h3 id="viewspy">views.py:</h3>
<h3 id="_5">Представление главной страницы:</h3>
<pre><code class="language-python">def index(request):
    if request.user.is_authenticated:
        return render(request, 'index.html')
    else:
        return render(request, 'auth.html')
</code></pre>
<h3 id="_6">Представление регистрации:</h3>
<pre><code class="language-python">def registration(request):
    if request.method == &quot;POST&quot;:
        form = NewUserForm(request.POST)
        if form.is_valid():
            user = form.save()
            login(request, user)
            return redirect('/')
    else:
        form = NewUserForm()
    return render(request, &quot;register.html&quot;, {&quot;register_form&quot;: form})

</code></pre>
<h3 id="_7">Представление авторизации и входа:</h3>
<pre><code class="language-python">def logout_view(request):
    logout(request)
    return redirect('/')


def auth(request):
    username = request.POST.get('username')
    password = request.POST.get('password')
    user = authenticate(request, username=username, password=password)
    if user is not None:
        login(request, user)
        return redirect('/')
    else:
        return render(request, 'auth.html', {'error': 'Try again'})

</code></pre>
<h3 id="_8">Представление билетов:</h3>
<pre><code class="language-python">def tickets(request):
    user_tickets = Ticket.objects.filter(user=request.user)
    return render(request, 'tickets.html', {'tickets': user_tickets})
</code></pre>
<h3 id="_9">Представление полетов:</h3>
<pre><code class="language-python">def flights(request):
    return render(request, 'flights.html', {'flights': Flight.objects.all()})
</code></pre>
<h3 id="_10">Представление пассажиров:</h3>
<pre><code class="language-python">def users_list(request, flight_id):
    user_ids = Ticket.objects.filter(flight_id=flight_id).values('user_id')
    users = User.objects.filter(id__in=user_ids)
    flight = Flight.objects.get(id=flight_id)
    return render(request, &quot;users.html&quot;, {
        &quot;users&quot;: users,
        &quot;flight&quot;: flight,
    })
</code></pre>
<h3 id="_11">Представление Комментария:</h3>
<pre><code class="language-python">def feedbacks(request, flight_id):
    flight = Flight.objects.get(id=flight_id)
    feedbacks = Feedback.objects.filter(flight_id=flight_id)
    return render(request, &quot;feedbacks.html&quot;, {
        &quot;feedbacks&quot;: feedbacks,
        &quot;flight&quot;: flight,
    })

def create_feedback(request, flight_id):
    if request.method == 'POST':
        form = FeedbackForm(request.POST)
        if form.is_valid():
            Feedback.objects.create(comment=form.cleaned_data.get('comment'),
                                    rate=form.cleaned_data.get('rating'),
                                    date=form.cleaned_data.get('date'),
                                    user_id=request.user.id,
                                    flight_id=flight_id)

            return redirect('/flights')
    else:
        form = FeedbackForm()
    return render(request, 'leave_feedback.html', {'form': form})

</code></pre>
<h3 id="_12">Представление операций над билетами:</h3>
<pre><code class="language-python">def delete_ticket(request, ticket_id):
    ticket = Ticket.objects.get(ticket_id=ticket_id)
    if ticket.user_id == request.user.id:
        ticket.delete()
    return redirect('/tickets')


@login_required
def update_ticket(request, ticket_id):
    ticket = get_object_or_404(Ticket, ticket_id=ticket_id) 

    if ticket.user_id != request.user.id:
        return redirect('/') 

    if request.method == 'POST':
        form = TicketUpdateForm(request.POST)
        if form.is_valid():
            ticket.seat = form.cleaned_data.get('seat')
            ticket.save()
            return redirect('/tickets') 
        else:
        form = TicketUpdateForm(initial={'seat': ticket.seat})

    return render(request, 'update.html', {'form': form, 'ticket': ticket})

</code></pre>
<h3 id="_13">Представление подтверждения бронирования для администратра:</h3>
<pre><code class="language-python">@login_required
@user_passes_test(lambda u: u.is_superuser)
def manage_bookings(request):
    tickets = Ticket.objects.all()

    if request.method == 'POST':
        ticket_id = request.POST.get('ticket_id')
        action = request.POST.get('action')

        ticket = get_object_or_404(Ticket, ticket_id=ticket_id)

        if action == 'confirm':
            ticket.is_confirmed = True
            ticket.save()
        elif action == 'reject':
            ticket.delete()

        return redirect('/tickets')

    return render(request, 'manage_bookings.html', {'tickets': tickets})
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../models/" class="btn btn-neutral float-left" title="models"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../urls/" class="btn btn-neutral float-right" title="urls">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../models/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../urls/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
